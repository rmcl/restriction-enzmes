package sequence

import (
	"reflect"
	"testing"

	"github.com/rmcl/restriction-enzymes/db"
)

func TestGetNextRecognitionSite(t *testing.T) {
	dSeq1 := NewFromWatsonStrand("NNGGTCTCNCACANNNNCTCTNGAGACCNN", Linear)

	enzyme := db.Enzymes["BsaI"]

	index, strand := GetNextRecognitionSite(dSeq1.Watson, 0, enzyme, true)
	if index != 2 {
		t.Errorf("Expected 2, got %d", index)
		return
	}
	if strand != Watson {
		t.Errorf("Expected Watson, got %s", strand)
		return
	}

	index, strand = GetNextRecognitionSite(dSeq1.Watson, 3, enzyme, true)
	if index != 22 {
		t.Errorf("Expected 22, got %d", index)
		return
	}
	if strand != Crick {
		t.Errorf("Expected Watson, got %s", strand)
		return
	}

}

func TestCutDSeqWatsonStrandOnly(t *testing.T) {
	dSeq1 := NewFromWatsonStrand("NNGGTCTCNCACANNNNCTCT", Linear)

	fragments := dSeq1.Cut(db.Enzymes["BsaI"])

	for _, fragment := range fragments {
		fragment.Print()
	}

	if len(fragments) != 2 {
		t.Errorf("Expected 2 fragments, got %d, Fragments: %v", len(fragments), fragments)
	}

	if fragments[0].Watson != "NNGGTCTCN" {
		t.Errorf("Expected NNGGTCTCN, got %s", fragments[0].Watson)
	}
	if fragments[0].Crick != "NNCCAGAGNGTGT" {
		t.Errorf("Expected NNCCAGAGNGTGT, got %s", fragments[0].Crick)
	}

}

func TestCutDSeqCutSiteOnBothStrands(t *testing.T) {
	dSeq1 := NewFromWatsonStrand("NNGGTCTCNCACANNNNCTCTNGAGACCNN", Linear)

	fragments := dSeq1.Cut(db.Enzymes["BsaI"])

	for _, fragment := range fragments {
		fragment.Print()
	}

	if len(fragments) != 3 {
		t.Errorf("Expected 3 fragments, got %d, Fragments: %v", len(fragments), fragments)
	}

	expected := []string{
		"NNGGTCTCN", "NNCCAGAGNGTGT", //Frag 1
		"CACANNNN", "NNNNGAGA", // Frag 2
		"CTCTNGAGACCNN", "NCTCTGGNN", // Frag 3
	}

	actual := []string{
		fragments[0].Watson, fragments[0].Crick,
		fragments[1].Watson, fragments[1].Crick,
		fragments[2].Watson, fragments[2].Crick,
	}

	if reflect.DeepEqual(expected, actual) == false {
		t.Errorf("Expected fragments %v, got %v", expected, actual)
	}

}

func TestCutSeqLongSeqNewEnzyme(t *testing.T) {
	sequence := "ATGACATAACCGTATTACCGCCATGCATTAGTTATTAATAGTAATCAATTACGGGGTCATTAGTTCATAGCCCATATATGGAGTTCCGCGTTACATAACTTACGGTAAATGGCCCGCCTGGCTGACCGCCCAACGACCCCCGCCCATTGACGTCAATAATGACGTATGTTCCCATAGTAACGCCAATAGGGACTTTCCATTGACGTCAATGGGTGGAGTATTTACGGTAAACTGCCCACTTGGCAGTACATCAAGTGTATCATATGCCAAGTACGCCCCCTATTGACGTCAATGACGGTAAATGGCCCGCCTGGCATTATGCCCAGTACATGACCTTATGGGACTTTCCTACTTGGCAGTACATCTACGTATTAGTCATCGCTATTACCATGGTGATGCGGTTTTGGCAGTACATCAATGGGCGTGGATAGCGGTTTGACTCACGGGGATTTCCAAGTCTCCACCCCATTGACGTCAATGGGAGTTTGTTTTGGCACCAAAATCAACGGGACTTTCCAAAATGTCGTAACAACTCCGCCCCATTGACGCAAATGGGCGGTAGGCGTGTACGGTGGGAGGTCTATATAAGCAGAGCTGGTTTAGTGAACCGTCAGATCCGCTAGTCGACGGTACCTCGGCGATGGCTTTTCCGCCGCGGCGACGGCTGCGCCTCGGTCCCCGCGGCCTCCCGCTTCTTCTCTCGGGACTCCTGCTACCTCTGTGCCGCGCCTTCAACCTAGACGTGGACAGTCCTGCCGAGTACTCTGGCCCCGAGGGAAGTTACTTCGGCTTCGCCGTGGATTTCTTCGTGCCCAGCGCGTCTTCCCGGATGTTTCTTCTCGTGGGAGCTCCCAAAGCAAACACCACCCAGCCTGGGATTGTGGAAGGAGGGCAGGTCCTCAAATGTGACTGGTCTTCTACCCGCCGGTGCCAGCCAATTGAATTTGATGCAACAGGCAATAGAGATTATGCCAAGGATGATCCATTGGAATTTAAGTCCCATCAGTGGTTTGGAGCATCTGTGAGGTCGAAACAGGATAAAATTTTGGCCTGTGCCCCATTGTACCATTGGAGAACTGAGATGAAACAGGAGCGAGAGCCTGTTGGAACATGCTTTCTTCAAGATGGAACAAAGACTGTTGAGTATGCTCCATGTAGATCACAAGATATTGATGCTGATGGACAGGGATTTTGTCAAGGAGGATTCAGCATTGATTTTACTAAAGCTGACAGAGTACTTCTTGGTGGTCCTGGTAGCTTTTATTGGCAAGGTCAGCTTATTTCGGATCAAGTGGCAGAAATCGTATCTAAATACGACCCCAATGTTTACAGCATCAAGTATAATAACCAATTAGCAACTCGGACTGCACAAGCTATTTTTGATGACAGCTATTTGGGTTATTCTGTGGCTGTCGGAGATTTCAATGGTGATGGCATAGATGACTTTGTTTCAGGAGTTCCAAGAGCAGCAAGGACTTTGGGAATGGTTTATATTTATGATGGGAAGAACATGTCCTCCTTATACAATTTTACTGGCGAGCAGATGGCTGCATATTTCGGATTTTCTGTAGCTGCCACTGACATTAATGGAGATGATTATGCAGATGTGTTTATTGGAGCACCTCTCTTCATGGATCGTGGCTCTGATGGCAAACTCCAAGAGGTGGGGCAGGTCTCAGTGTCTCTACAGAGAGCTTCAGGAGACTTCCAGACGACAAAGCTGAATGGATTTGAGGTCTTTGCACGGTTTGGCAGTGCCATAGCTCCTTTGGGAGATCTGGACCAGGATGGTTTCAATGATATTGCAATTGCTGCTCCATATGGGGGTGAAGATAAAAAAGGAATTGTTTATATCTTCAATGGAAGATCAACAGGCTTGAACGCAGTCCCATCTCAAATCCTTGAAGGGCAGTGGGCTGCTCGAAGCATGCCACCAAGCTTTGGCTATTCAATGAAAGGAGCCACAGATATAGACAAAAATGGATATCCAGACTTAATTGTAGGAGCTTTTGGTGTAGATCGAGCTATCTTATACAGGGCCAGACCAGTTATCACTGTAAATGCTGGTCTTGAAGTGTACCCTAGCATTTTAAATCAAGACAATAAAACCTGCTCACTGCCTGGAACAGCTCTCAAAGTTTCCTGTTTTAATGTTAGGTTCTGCTTAAAGGCAGATGGCAAAGGAGTACTTCCCAGGAAACTTAATTTCCAGGTGGAACTTCTTTTGGATAAACTCAAGCAAAAGGGAGCAATTCGACGAGCACTGTTTCTCTACAGCAGGTCCCCAAGTCACTCCAAGAACATGACTATTTCAAGGGGGGGACTGATGCAGTGTGAGGAATTGATAGCGTATCTGCGGGATGAATCTGAATTTAGAGACAAACTCACTCCAATTACTATTTTTATGGAATATCGGTTGGATTATAGAACAGCTGCTGATACAACAGGCTTGCAACCCATTCTTAACCAGTTCACGCCTGCTAACATTAGTCGACAGGCTCACATTCTACTTGACTGTGGTGAAGACAATGTCTGTAAACCCAAGCTGGAAGTTTCTGTAGATAGTGATCAAAAGAAGATCTATATTGGGGATGACAACCCTCTGACATTGATTGTTAAGGCTCAGAATCAAGGAGAAGGTGCCTACGAAGCTGAGCTCATCGTTTCCATTCCACTGCAGGCTGATTTCATCGGGGTTGTCCGAAACAATGAAGCCTTAGCAAGACTTTCCTGTGCATTTAAGACAGAAAACCAAACTCGCCAGGTGGTATGTGACCTTGGAAACCCAATGAAGGCTGGAACTCAACTCTTAGCTGGTCTTCGTTTCAGTGTGCACCAGCAGTCAGAGATGGATACTTCTGTGAAATTTGACTTACAAATCCAAAGCTCAAATCTATTTGACAAAGTAAGCCCAGTTGTATCTCACAAAGTTGATCTTGCTGTTTTAGCTGCAGTTGAGATAAGAGGAGTCTCGAGTCCTGATCATATCTTTCTTCCGATTCCAAACTGGGAGCACAAGGAGAACCCTGAGACTGAAGAAGATGTTGGGCCAGTTGTTCAGCACATCTATGAGCTGAGAAACAATGGTCCAAGTTCATTCAGCAAGGCAATGCTCCATCTTCAGTGGCCTTACAAATATAATAATAACACTCTGTTGTATATCCTTCATTATGATATTGATGGACCAATGAACTGCACTTCAGATATGGAGATCAACCCTTTGAGAATTAAGATCTCATCTTTGCAAACAACTGAAAAGAATGACACGGTTGCCGGGCAAGGTGAGCGGGACCATCTCATCACTAAGCGGGATCTTGCCCTCAGTGAAGGAGATATTCACACTTTGGGTTGTGGAGTTGCTCAGTGCTTGAAGATTGTCTGCCAAGTTGGGAGATTAGACAGAGGAAAGAGTGCAATCTTGTACGTAAAGTCATTACTGTGGACTGAGACTTTTATGAATAAAGAAAATCAGAATCATTCCTATTCTCTGAAGTCGTCTGCTTCATTTAATGTCATAGAGTTTCCTTATAAGAATCTTCCAATTGAGGATATCACCAACTCCACATTGGTTACCACTAATGTCACCTGGGGCATTCAGCCAGCGCCCATGCCTGTGCCTGTGTGGGTGATCATTTTAGCAGTTCTAGCAGGATTGTTGCTACTGGCTGTTTTGGTATTTGTAATGTACAGGATGGGCTTTTTTAAACGGGTCCGGCCACCTCAAGAAGAACAAGAAAGGGAGCAGCTTCAACCTCATGAAAATGGTGAAGGAAACTCAGAAACTCCGGGATCTCGAGCTCAAGCTTCGAATTCTGCAGTCGACGGTACCGCGGGCCCGGGATCCCCACCGGTCGCCACCATGGTGAGCAAGGGCGAGGAGCTGTTCACCGGGGTGGTGCCCATCCTGGTCGAGCTGGACGGCGACGTAAACGGCCACAAGTTCAGCGTGTCCGGCGAGGGCGAGGGCGATGCCACCTACGGCAAGCTGACCCTGAAGTTCATCTGCACCACCGGCAAGCTGCCCGTGCCCTGGCCCACCCTCGTGACCACCTTGACCTACGGCGTGCAGTGCTTCGCCCGCTACCCCGACCACATGAAGCAGCACGACTTCTTCAAGTCCGCCATGCCCGAAGGCTACGTCCAGGAGCGCACCATCTTCTTCAAGGACGACGGCAACTACAAGACCCGCGCCGAGGTGAAGTTCGAGGGCGACACCCTGGTGAACCGCATCGAGCTGAAGGGCATCGACTTCAAGGAGGACGGCAACATCCTGGGGCACAAGCTGGAGTACAACTACAACAGCCACAAGGTCTATATCACCGCCGACAAGCAGAAGAACGGCATCAAGGTGAACTTCAAGACCCGCCACAACATCGAGGACGGCAGCGTGCAGCTCGCCGACCACTACCAGCAGAACACCCCCATCGGCGACGGCCCCGTGCTGCTGCCCGACAACCACTACCTGAGCACCCAGTCCAAGCTGAGCAAAGACCCCAACGAGAAGCGCGATCACATGGTCCTGCTGGAGTTCGTGACCGCCGCCGGGATCACTCTCGGCATGGACGAGCTGTACAAGTAAGCGGCCGCGACTCTAGATCATAATCAGCCATACCACATTTGTAGAGGTTTTACTTGCTTTAAAAAACCTCCCACACCTCCCCCTGAACCTGAAACATAAAATGAATGCAATTGTTGTTGTTAACTTGTTTATTGCAGCTTATAATGGTTACAAATAAAGCAATAGCATCACAAATTTCACAAATAAAGCATTTTTTTCACTGCATTCTAGTTGTGGTTTGTCCAAACTCATCAATGTATCTTAAGGCGTAAATTGTAAGCGTTAATATTTTGTTAAAATTCGCGTTAAATTTTTGTTAAATCAGCTCATTTTTTAACCAATAGGCCGAAATCGGCAAAATCCCTTATAAATCAAAAGAATAGACCGAGATAGGGTTGAGTGTTGTTCCAGTTTGGAACAAGAGTCCACTATTAAAGAACGTGGACTCCAACGTCAAAGGGCGAAAAACCGTCTATCAGGGCGATGGCCCACTACGTGAACCATCACCCTAATCAAGTTTTTTGGGGTCGAGGTGCCGTAAAGCACTAAATCGGAACCCTAAAGGGAGCCCCCGATTTAGAGCTTGACGGGGAAAGCCGGCGAACGTGGCGAGAAAGGAAGGGAAGAAAGCGAAAGGAGCGGGCGCTAGGGCGCTGGCAAGTGTAGCGGTCACGCTGCGCGTAACCACCACACCCGCCGCGCTTAATGCGCCGCTACAGGGCGCGTCAGGTGGCACTTTTCGGGGAAATGTGCGCGGAACCCCTATTTGTTTATTTTTCTAAATACATTCAAATATGTATCCGCTCATGAGACAATAACCCTGATAAATGCTTCAATAATATTGAAAAAGGAAGAGTCCTGAGGCGGAAAGAACCAGCTGTGGAATGTGTGTCAGTTAGGGTGTGGAAAGTCCCCAGGCTCCCCAGCAGGCAGAAGTATGCAAAGCATGCATCTCAATTAGTCAGCAACCAGGTGTGGAAAGTCCCCAGGCTCCCCAGCAGGCAGAAGTATGCAAAGCATGCATCTCAATTAGTCAGCAACCATAGTCCCGCCCCTAACTCCGCCCATCCCGCCCCTAACTCCGCCCAGTTCCGCCCATTCTCCGCCCCATGGCTGACTAATTTTTTTTATTTATGCAGAGGCCGAGGCCGCCTCGGCCTCTGAGCTATTCCAGAAGTAGTGAGGAGGCTTTTTTGGAGGCCTAGGCTTTTGCAAAGATCGATCAAGAGACAGGATGAGGATCGTTTCGCATGATTGAACAAGATGGATTGCACGCAGGTTCTCCGGCCGCTTGGGTGGAGAGGCTATTCGGCTATGACTGGGCACAACAGACAATCGGCTGCTCTGATGCCGCCGTGTTCCGGCTGTCAGCGCAGGGGCGCCCGGTTCTTTTTGTCAAGACCGACCTGTCCGGTGCCCTGAATGAACTGCAAGACGAGGCAGCGCGGCTATCGTGGCTGGCCACGACGGGCGTTCCTTGCGCAGCTGTGCTCGACGTTGTCACTGAAGCGGGAAGGGACTGGCTGCTATTGGGCGAAGTGCCGGGGCAGGATCTCCTGTCATCTCACCTTGCTCCTGCCGAGAAAGTATCCATCATGGCTGATGCAATGCGGCGGCTGCATACGCTTGATCCGGCTACCTGCCCATTCGACCACCAAGCGAAACATCGCATCGAGCGAGCACGTACTCGGATGGAAGCCGGTCTTGTCGATCAGGATGATCTGGACGAAGAGCATCAGGGGCTCGCGCCAGCCGAACTGTTCGCCAGGCTCAAGGCGAGCATGCCCGACGGCGAGGATCTCGTCGTGACCCATGGCGATGCCTGCTTGCCGAATATCATGGTGGAAAATGGCCGCTTTTCTGGATTCATCGACTGTGGCCGGCTGGGTGTGGCGGACCGCTATCAGGACATAGCGTTGGCTACCCGTGATATTGCTGAAGAGCTTGGCGGCGAATGGGCTGACCGCTTCCTCGTGCTTTACGGTATCGCCGCTCCCGATTCGCAGCGCATCGCCTTCTATCGCCTTCTTGACGAGTTCTTCTGAGCGGGACTCTGGGGTTCGAAATGACCGACCAAGCGACGCCCAACCTGCCATCACGAGATTTCGATTCCACCGCCGCCTTCTATGAAAGGTTGGGCTTCGGAATCGTTTTCCGGGACGCCGGCTGGATGATCCTCCAGCGCGGGGATCTCATGCTGGAGTTCTTCGCCCACCCTAGGGGGAGGCTAACTGAAACACGGAAGGAGACAATACCGGAAGGAACCCGCGCTATGACGGCAATAAAAAGACAGAATAAAACGCACGGTGTTGGGTCGTTTGTTCATAAACGCGGGGTTCGGTCCCAGGGCTGGCACTCTGTCGATACCCCACCGAGACCCCATTGGGGCCAATACGCCCGCGTTTCTTCCTTTTCCCCACCCCACCCCCCAAGTTCGGGTGAAGGCCCAGGGCTCGCAGCCAACGTCGGGGCGGCAGGCCCTGCCATAGCCTCAGGTTACTCATATATACTTTAGATTGATTTAAAACTTCATTTTTAATTTAAAAGGATCTAGGTGAAGATCCTTTTTGATAATCTCATGACCAAAATCCCTTAACGTGAGTTTTCGTTCCACTGAGCGTCAGACCCCGTAGAAAAGATCAAAGGATCTTCTTGAGATCCTTTTTTTCTGCGCGTAATCTGCTGCTTGCAAACAAAAAAACCACCGCTACCAGCGGTGGTTTGTTTGCCGGATCAAGAGCTACCAACTCTTTTTCCGAAGGTAACTGGCTTCAGCAGAGCGCAGATACCAAATACTGTTCTTCTAGTGTAGCCGTAGTTAGGCCACCACTTCAAGAACTCTGTAGCACCGCCTACATACCTCGCTCTGCTAATCCTGTTACCAGTGGCTGCTGCCAGTGGCGATAAGTCGTGTCTTACCGGGTTGGACTCAAGACGATAGTTACCGGATAAGGCGCAGCGGTCGGGCTGAACGGGGGGTTCGTGCACACAGCCCAGCTTGGAGCGAACGACCTACACCGAACTGAGATACCTACAGCGTGAGCTATGAGAAAGCGCCACGCTTCCCGAAGGGAGAAAGGCGGACAGGTATCCGGTAAGCGGCAGGGTCGGAACAGGAGAGCGCACGAGGGAGCTTCCAGGGGGAAACGCCTGGTATCTTTATAGTCCTGTCGGGTTTCGCCACCTCTGACTTGAGCGTCGATTTTTGTGATGCTCGTCAGGGGGGCGGAGCCTATGGAAAAACGCCAGCAACGCGGCCTTTTTACGGTTCCTGGCCTTTTGCTGGCCTTTTGCTCACATGTTCTTTCCTGCGTTATCCCCTGATTCTGTGGAA"

	dSeq := NewFromWatsonStrand(sequence, Linear)
	index, strand := GetNextRecognitionSite(dSeq.Watson, 0, db.Enzymes["EcoRI"], true)

	if index != 3807 {
		t.Errorf("Expected 3807, got %d", index)
		return
	}
	if strand != Crick {
		t.Errorf("Expected Crick, got %s", strand)
		return
	}
}
